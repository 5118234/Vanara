<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-en-US.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>AdvApi32.AdjustTokenPrivileges Method (AdvApi32.SafeTokenHandle, Boolean, AdvApi32.PTOKEN_PRIVILEGES, UInt32, SafeCoTaskMemHandle, UInt32)</title><meta name="Language" content="en-us" /><meta name="Microsoft.Help.Id" content="M:Vanara.PInvoke.AdvApi32.AdjustTokenPrivileges(Vanara.PInvoke.AdvApi32.SafeTokenHandle,System.Boolean,Vanara.PInvoke.AdvApi32.PTOKEN_PRIVILEGES,System.UInt32,Vanara.InteropServices.SafeCoTaskMemHandle,System.UInt32@)" /><meta name="Description" content="The AdjustTokenPrivileges function enables or disables privileges in the specified access token. Enabling or disabling privileges in an access token requires TOKEN_ADJUST_PRIVILEGES access." /><meta name="Microsoft.Help.ContentType" content="Reference" /><meta name="BrandingAware" content="true" /><meta name="container" content="Vanara.PInvoke" /><meta name="file" content="398217b9-1382-17e5-4c29-1a70ca9f162f" /><meta name="guid" content="398217b9-1382-17e5-4c29-1a70ca9f162f" /><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">Vanara API Documentation<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="d22522ce-4106-42b2-81eb-cb37a0f36df8.htm" title="Vanara API Documentation" tocid="roottoc">Vanara API Documentation</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="c0250011-c1b9-bc9a-b501-96a9795f44a5.htm" title="Vanara.PInvoke" tocid="c0250011-c1b9-bc9a-b501-96a9795f44a5">Vanara.PInvoke</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="9e2975d6-cd80-a5d1-8428-fefbd08eac87.htm" title="AdvApi32 Class" tocid="9e2975d6-cd80-a5d1-8428-fefbd08eac87">AdvApi32 Class</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="7f8c165a-260f-d23f-8357-ee127065012d.htm" title="AdvApi32 Methods" tocid="7f8c165a-260f-d23f-8357-ee127065012d">AdvApi32 Methods</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="b3a9c632-05f1-a886-2020-6bb6dc002b85.htm" title="AdjustTokenPrivileges Method " tocid="b3a9c632-05f1-a886-2020-6bb6dc002b85">AdjustTokenPrivileges Method </a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="ea195614-54dd-733e-db14-08b9ed74db90.htm" title="AdjustTokenPrivileges Method (AdvApi32.SafeTokenHandle, Boolean, SafeCoTaskMemHandle, UInt32, SafeCoTaskMemHandle, UInt32)" tocid="ea195614-54dd-733e-db14-08b9ed74db90">AdjustTokenPrivileges Method (AdvApi32.SafeTokenHandle, Boolean, SafeCoTaskMemHandle, UInt32, SafeCoTaskMemHandle, UInt32)</a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="398217b9-1382-17e5-4c29-1a70ca9f162f.htm" title="AdjustTokenPrivileges Method (AdvApi32.SafeTokenHandle, Boolean, AdvApi32.PTOKEN_PRIVILEGES, UInt32, SafeCoTaskMemHandle, UInt32)" tocid="398217b9-1382-17e5-4c29-1a70ca9f162f">AdjustTokenPrivileges Method (AdvApi32.SafeTokenHandle, Boolean, AdvApi32.PTOKEN_PRIVILEGES, UInt32, SafeCoTaskMemHandle, UInt32)</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="logoColumn"><img src="../icons/Help.png" /></td><td class="titleColumn"><h1>AdvApi32<span id="LSTF091442F_0"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTF091442F_0?cpp=::|nu=.");</script>AdjustTokenPrivileges Method (AdvApi32<span id="LSTF091442F_1"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTF091442F_1?cpp=::|nu=.");</script>SafeTokenHandle, Boolean, AdvApi32<span id="LSTF091442F_2"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTF091442F_2?cpp=::|nu=.");</script>PTOKEN_PRIVILEGES, UInt32, SafeCoTaskMemHandle, UInt32<span id="LSTF091442F_3"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTF091442F_3?cpp=%");</script>)</h1></td></tr></table><span class="introStyle"></span> <div class="summary">
            The AdjustTokenPrivileges function enables or disables privileges in the specified access token. Enabling or disabling privileges in an access token
            requires TOKEN_ADJUST_PRIVILEGES access.
            </div><p> </p>
    <strong>Namespace:</strong> 
   <a href="c0250011-c1b9-bc9a-b501-96a9795f44a5.htm">Vanara.PInvoke</a><br />
    <strong>Assembly:</strong>
   Vanara.PInvoke.Security (in Vanara.PInvoke.Security.dll) Version: 1.0.2<div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID1RB')" onkeypress="SectionExpandCollapse_CheckKey('ID1RB', event)" tabindex="0"><img id="ID1RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Syntax</span></div><div id="ID1RBSection" class="collapsibleSection"><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EBCA_tab1" class="codeSnippetContainerTab"><a href="#" onclick="javascript:ChangeTab('ID0EBCA','cs','1','2');return false;">C#</a></div><div id="ID0EBCA_tab2" class="codeSnippetContainerTab"><a href="#" onclick="javascript:ChangeTab('ID0EBCA','vb','2','2');return false;">VB</a></div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EBCA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EBCA');return false;" title="Copy">Copy</a></div></div><div id="ID0EBCA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">bool</span> <span class="identifier">AdjustTokenPrivileges</span>(
	<span class="identifier">AdvApi32<span id="LSTF091442F_4"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTF091442F_4?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>SafeTokenHandle</span> <span class="parameter">objectHandle</span>,
	<span class="identifier">bool</span> <span class="parameter">DisableAllPrivileges</span>,
	<span class="identifier">AdvApi32<span id="LSTF091442F_5"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTF091442F_5?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>PTOKEN_PRIVILEGES</span> <span class="parameter">NewState</span>,
	<span class="identifier">uint</span> <span class="parameter">BufferLength</span>,
	<span class="identifier">SafeCoTaskMemHandle</span> <span class="parameter">PreviousState</span>,
	<span class="keyword">out</span> <span class="identifier">uint</span> <span class="parameter">ReturnLength</span>
)</pre></div><div id="ID0EBCA_code_Div2" class="codeSnippetContainerCode" style="display: none"><pre xml:space="preserve"><span class="keyword">Public</span> <span class="keyword">Shared</span> <span class="keyword">Function</span> <span class="identifier">AdjustTokenPrivileges</span> ( 
	<span class="parameter">objectHandle</span> <span class="keyword">As</span> <span class="identifier">AdvApi32<span id="LSTF091442F_6"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTF091442F_6?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>SafeTokenHandle</span>,
	<span class="parameter">DisableAllPrivileges</span> <span class="keyword">As</span> <span class="identifier">Boolean</span>,
	<span class="parameter">NewState</span> <span class="keyword">As</span> <span class="identifier">AdvApi32<span id="LSTF091442F_7"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTF091442F_7?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>PTOKEN_PRIVILEGES</span>,
	<span class="parameter">BufferLength</span> <span class="keyword">As</span> <span class="identifier">UInteger</span>,
	&lt;<span class="identifier">OutAttribute</span>&gt; <span class="parameter">PreviousState</span> <span class="keyword">As</span> <span class="identifier">SafeCoTaskMemHandle</span>,
	&lt;<span class="identifier">OutAttribute</span>&gt; <span class="keyword">ByRef</span> <span class="parameter">ReturnLength</span> <span class="keyword">As</span> <span class="identifier">UInteger</span>
) <span class="keyword">As</span> <span class="identifier">Boolean</span></pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EBCA");</script><h4 class="subHeading">Parameters</h4><dl><dt><span class="parameter">objectHandle</span></dt><dd>Type: <a href="4d782b4d-16f7-2f9b-0f39-b3bf534ad01a.htm">Vanara.PInvoke<span id="LSTF091442F_8"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTF091442F_8?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>AdvApi32<span id="LSTF091442F_9"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTF091442F_9?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>SafeTokenHandle</a><br />
            A handle to the access token that contains the privileges to be modified. The handle must have TOKEN_ADJUST_PRIVILEGES access to the token. If the
            PreviousState parameter is not NULL, the handle must also have TOKEN_QUERY access.
            </dd><dt><span class="parameter">DisableAllPrivileges</span></dt><dd>Type: <a href="http://msdn2.microsoft.com/en-us/library/a28wyd50" target="_blank">System<span id="LSTF091442F_10"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTF091442F_10?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>Boolean</a><br />
            Specifies whether the function disables all of the token's privileges. If this value is TRUE, the function disables all privileges and ignores the
            NewState parameter. If it is FALSE, the function modifies privileges based on the information pointed to by the NewState parameter.
            </dd><dt><span class="parameter">NewState</span></dt><dd>Type: <a href="1b68c23e-59c3-1abc-61e7-cde1fe1ed679.htm">Vanara.PInvoke<span id="LSTF091442F_11"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTF091442F_11?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>AdvApi32<span id="LSTF091442F_12"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTF091442F_12?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>PTOKEN_PRIVILEGES</a><br />
            A pointer to a TOKEN_PRIVILEGES structure that specifies an array of privileges and their attributes. If DisableAllPrivileges is TRUE, the function
            ignores this parameter. If the DisableAllPrivileges parameter is FALSE, the AdjustTokenPrivileges function enables, disables, or removes these
            privileges for the token. The following table describes the action taken by the AdjustTokenPrivileges function, based on the privilege attribute.
            </dd><dt><span class="parameter">BufferLength</span></dt><dd>Type: <a href="http://msdn2.microsoft.com/en-us/library/ctys3981" target="_blank">System<span id="LSTF091442F_13"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTF091442F_13?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>UInt32</a><br />
            Specifies the size, in bytes, of the buffer pointed to by the PreviousState parameter. This parameter can be zero if the PreviousState parameter is NULL.
            </dd><dt><span class="parameter">PreviousState</span></dt><dd>Type: <a href="bbe30f67-7654-0850-8630-770714a104d3.htm">Vanara.InteropServices<span id="LSTF091442F_14"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTF091442F_14?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>SafeCoTaskMemHandle</a><br />
            A pointer to a buffer that the function fills with a TOKEN_PRIVILEGES structure that contains the previous state of any privileges that the function
            modifies. That is, if a privilege has been modified by this function, the privilege and its previous state are contained in the TOKEN_PRIVILEGES
            structure referenced by PreviousState. If the PrivilegeCount member of TOKEN_PRIVILEGES is zero, then no privileges have been changed by this
            function. This parameter can be NULL.
            <p>
            If you specify a buffer that is too small to receive the complete list of modified privileges, the function fails and does not adjust any privileges.
            In this case, the function sets the variable pointed to by the ReturnLength parameter to the number of bytes required to hold the complete list of
            modified privileges.
            </p></dd><dt><span class="parameter">ReturnLength</span></dt><dd>Type: <a href="http://msdn2.microsoft.com/en-us/library/ctys3981" target="_blank">System<span id="LSTF091442F_15"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTF091442F_15?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>UInt32</a><span id="LSTF091442F_16"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTF091442F_16?cpp=%");</script><br />
            A pointer to a variable that receives the required size, in bytes, of the buffer pointed to by the PreviousState parameter. This parameter can be
            NULL if PreviousState is NULL.
            </dd></dl><h4 class="subHeading">Return Value</h4>Type: <a href="http://msdn2.microsoft.com/en-us/library/a28wyd50" target="_blank">Boolean</a><br />
            If the function succeeds, the return value is nonzero. To determine whether the function adjusted all of the specified privileges, call GetLastError,
            which returns either ERROR_SUCCESS, indicating that the function adjusted all specified privileges, or ERROR_NOT_ALL_ASSIGNED, indicating that the
            token does not have one or more of the privileges specified in the NewState parameter. The function may succeed with this error value even if no
            privileges were adjusted. The PreviousState parameter indicates the privileges that were adjusted.
            <p>If the function fails, the return value is zero. To get extended error information, call GetLastError.</p></div><div class="collapsibleAreaRegion" id="seeAlsoSection"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0"><img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />See Also</span></div><div id="ID2RBSection" class="collapsibleSection"><h4 class="subHeading">Reference</h4><div class="seeAlsoStyle"><a href="9e2975d6-cd80-a5d1-8428-fefbd08eac87.htm">AdvApi32 Class</a></div><div class="seeAlsoStyle"><a href="b3a9c632-05f1-a886-2020-6bb6dc002b85.htm">AdjustTokenPrivileges Overload</a></div><div class="seeAlsoStyle"><a href="c0250011-c1b9-bc9a-b501-96a9795f44a5.htm">Vanara.PInvoke Namespace</a></div></div></div></div><div id="pageFooter" class="pageFooter"> </div></body></html>